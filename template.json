{
  "variables": {
    "source_path": "{{env source_path}}",
    "time": "{{env time}}",
    "vm_name": "{{env vm_name}}"
  },
  "builders": [
    {
      "type": "virtualbox-ovf",
      "headless": false,
      "source_path": "{{user `source_path`}}",
      "ssh_username": "vagrant",
      "ssh_password": "vagrant",
      "ssh_private_key_file":"vendor/vagrant/keys/vagrant",
      "vboxmanage": [
        ["modifyvm", "{{.Name}}", "--memory", "1024"],
        ["modifyvm", "{{.Name}}", "--cpus", "2"]
      ],
      "guest_additions_mode": "disable",
      "shutdown_command": "echo 'vagrant' | sudo -S shutdown -P now"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "execute_command": "echo 'vagrant' | sudo -S sh -c '{{ .Vars }} {{ .Path }}'",
      "script": "scripts/install-virtualbox-guest-additions.sh"
    },
    {
      "type": "file",
      "source": "vendor/chef/chef.deb",
      "destination": "/tmp/chef.deb"
    },
    {
      "type": "chef-solo",
      "install_command": "echo 'vagrant' | sudo -S dpkg -i /tmp/chef.deb",
      "cookbook_paths": ["cookbooks/wp.dev/vendor/cookbooks"],
      "run_list": ["wp.dev::default"]
    },
    {
      "type": "shell",
      "inline": "sudo apt-get purge --auto-remove -y chef"
    }
  ],
  "post-processors": [
    [
      {
        "output": "{{user `vm_name`}}-{{.Provider}}-{{user `time`}}.box",
        "type": "vagrant",
        "keep_input_artifact": false,
        "compression_level": 9
      }
    ]
  ]
}
